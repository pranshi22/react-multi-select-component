import e,{useState as t,useMemo as r,useEffect as n,useRef as a,useCallback as o}from"react";function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}let s;const c={allItemsAreSelected:"All items are selected.",clearSearch:"Clear Search",clearSelected:"Clear Selected",noOptions:"No options",search:"Search",selectAll:"Select All",selectSomeItems:"Select...",create:"Create"},i={value:[],hasSelectAll:!0,className:"multi-select",debounceDuration:200,options:[]},d=e.createContext({}),m=({props:a,children:o})=>{const[m,u]=t(a.options);return r(()=>{"undefined"==typeof document||s||(s=document.createElement("style"),s.innerHTML=".rmsc{--rmsc-main:#4285f4;--rmsc-hover:#f1f3f5;--rmsc-selected:#e2e6ea;--rmsc-border:#ccc;--rmsc-gray:#aaa;--rmsc-bg:#fff;--rmsc-p:10px;--rmsc-radius:4px;--rmsc-h:38px}.rmsc *{box-sizing:border-box;transition:all .2s ease}.rmsc .gray{color:var(--rmsc-gray)}.rmsc .dropdown-content{padding-top:8px;position:absolute;top:100%;width:100%;z-index:1}.rmsc .dropdown-content .panel-content{background:var(--rmsc-bg);border-radius:var(--rmsc-radius);box-shadow:0 0 0 1px rgba(0,0,0,.1),0 4px 11px rgba(0,0,0,.1);overflow:hidden}.rmsc .dropdown-container{background-color:var(--rmsc-bg);border:1px solid var(--rmsc-border);border-radius:var(--rmsc-radius);outline:0;position:relative}.rmsc .dropdown-container[aria-disabled=true]:focus-within{border-color:var(--rmsc-gray);box-shadow:var(--rmsc-gray) 0 0 0 1px}.rmsc .dropdown-container:focus-within{border-color:var(--rmsc-main);box-shadow:var(--rmsc-main) 0 0 0 1px}.rmsc .dropdown-heading{align-items:center;cursor:default;display:flex;height:var(--rmsc-h);outline:0;padding:0 var(--rmsc-p);position:relative;width:100%}.rmsc .dropdown-heading .dropdown-heading-value{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rmsc .clear-selected-button{background:none;border:0;cursor:pointer;display:flex;padding:0}.rmsc .options{margin:0;max-height:260px;overflow-y:auto;padding-left:0}.rmsc .options li{list-style:none;margin:0}.rmsc .select-item{box-sizing:border-box;cursor:pointer;display:block;outline:0;padding:var(--rmsc-p)}.rmsc .select-item:focus,.rmsc .select-item:hover{background:var(--rmsc-hover)}.rmsc .select-item.selected{background:var(--rmsc-selected)}.rmsc .no-options{color:var(--rmsc-gray);padding:var(--rmsc-p);text-align:center}.rmsc .search{border-bottom:1px solid var(--rmsc-border);position:relative;width:100%}.rmsc .search input{border:0;height:var(--rmsc-h);outline:0;padding:0 var(--rmsc-p);width:100%}.rmsc .search-clear-button{background:none;border:0;bottom:0;cursor:pointer;padding:0 calc(var(--rmsc-p)/2);position:absolute;right:0;top:0}.rmsc .search-clear-button [hidden]{display:none}.rmsc .item-renderer{align-items:baseline;display:flex}.rmsc .item-renderer input{margin:0 5px 0 0}.rmsc .item-renderer.disabled{opacity:.5}.rmsc .spinner{-webkit-animation:rotate 2s linear infinite;animation:rotate 2s linear infinite}.rmsc .spinner .path{stroke:var(--rmsc-border);stroke-width:4px;stroke-linecap:round;-webkit-animation:dash 1.5s ease-in-out infinite;animation:dash 1.5s ease-in-out infinite}@-webkit-keyframes rotate{to{transform:rotate(1turn)}}@keyframes rotate{to{transform:rotate(1turn)}}@-webkit-keyframes dash{0%{stroke-dasharray:1,150;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-35}to{stroke-dasharray:90,150;stroke-dashoffset:-124}}@keyframes dash{0%{stroke-dasharray:1,150;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-35}to{stroke-dasharray:90,150;stroke-dashoffset:-124}}",document.head.appendChild(s))},[]),n(()=>{u(a.options)},[a.options]),e.createElement(d.Provider,{value:l({t:e=>{var t;return(null==(t=a.overrideStrings)?void 0:t[e])||c[e]}},i,a,{options:m,setOptions:u})},o)},u=()=>e.useContext(d),p={when:!0,eventTypes:["keydown"]};function h(e,t,l){const s=r(()=>Array.isArray(e)?e:[e],[e]),c=Object.assign({},p,l),{when:i,eventTypes:d}=c,m=a(t),{target:u}=c;n(()=>{m.current=t});const h=o(e=>{s.some(t=>e.key===t||e.code===t)&&m.current(e)},[s]);n(()=>{if(i&&"undefined"!=typeof window){const e=u?u.current:window;return d.forEach(t=>{e&&e.addEventListener(t,h)}),()=>{d.forEach(t=>{e&&e.removeEventListener(t,h)})}}},[i,d,s,u,t])}const b={ARROW_DOWN:"ArrowDown",ARROW_UP:"ArrowUp",ENTER:"Enter",ESCAPE:"Escape",SPACE:"Space"};function f(e,t){const r=e.length,n=t.length,a=[];if(!r||!n)return 0;if(r<n&&([e,t]=[t,e]),-1!==e.indexOf(t))return n+1/r;for(let e=0;e<=r;++e)a[e]=[0];for(let e=0;e<=n;++e)a[0][e]=0;for(let o=1;o<=r;++o)for(let r=1;r<=n;++r)a[o][r]=e[o-1]===t[r-1]?1+a[o-1][r-1]:Math.max(a[o][r-1],a[o-1][r]);return a[r][n]}function g(e,t){if(!e)return"";if(e=e.toUpperCase().replace(/((?=[^\u00E0-\u00FC])\W)|_/g,""),!t)return e;const r=t;return Object.keys(r).reduce((e,t)=>{const n=new RegExp(t,"g");return e.replace(n,r[t])},e)}const v=()=>e.createElement("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"dropdown-search-clear-icon gray"},e.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),E=({checked:t,option:r,onClick:n,disabled:a})=>e.createElement("div",{className:`item-renderer ${a&&"disabled"}`},e.createElement("input",{type:"checkbox",onChange:n,checked:t,tabIndex:-1,disabled:a}),e.createElement("span",null,r.label)),y=({itemRenderer:t=E,option:r,checked:n,tabIndex:o,disabled:l,onSelectionChanged:s,onClick:c})=>{const i=a(),d=()=>{l||s(!n)};return h([b.ENTER,b.SPACE],e=>{d(),e.preventDefault()},{target:i}),e.createElement("label",{className:`select-item ${n&&"selected"}`,role:"option","aria-selected":n,tabIndex:o,ref:i},e.createElement(t,{option:r,checked:n,onClick:e=>{d(),c(e)},disabled:l}))},k=({options:t,onClick:r,skipIndex:n})=>{const{disabled:a,value:o,onChange:l,ItemRenderer:s}=u();return e.createElement(e.Fragment,null,t.map((t,c)=>{const i=c+n;return e.createElement("li",{key:(null==t?void 0:t.key)||c},e.createElement(y,{tabIndex:i,option:t,onSelectionChanged:e=>{return r=t,void(a||l(e?[...o,r]:o.filter(e=>e.value!==r.value)));var r},checked:!!o.find(e=>e.value===t.value),onClick:e=>r(e,i),itemRenderer:s,disabled:t.disabled||a}))}))};var x;!function(e){e[e.SEARCH=0]="SEARCH",e[e.NONE=-1]="NONE"}(x||(x={}));const w=()=>{const{t:l,onChange:s,options:c,setOptions:i,value:d,filterOptions:m,selectAllLabel:p,ItemRenderer:E,disabled:w,disableSearch:C,hasSelectAll:N,ClearIcon:S,debounceDuration:A,isCreatable:R,onCreateOption:O}=u(),I=a(),P=a(),[W,T]=t(""),[_,D]=t(c),[M,L]=t(""),[$,H]=t(0),j=o(((e,t)=>{let r;return function(...n){clearTimeout(r),r=setTimeout(()=>{e.apply(null,n)},t)}})(e=>L(e),A),[]),F=r(()=>{let e=0;return C||(e+=1),N&&(e+=1),e},[C,N]),U={label:p||l("selectAll"),value:""},z=()=>{var e;L(""),T(""),null==P||null==(e=P.current)||e.focus()},B=e=>H(e);h([b.ARROW_DOWN,b.ARROW_UP],e=>{switch(e.code){case b.ARROW_UP:q(-1);break;case b.ARROW_DOWN:q(1);break;default:return}e.stopPropagation(),e.preventDefault()},{target:I});const q=e=>{let t=$+e;t=Math.max(0,t),t=Math.min(t,c.length+Math.max(F-1,0)),H(t)};n(()=>{var e,t;null==I||null==(e=I.current)||null==(t=e.querySelector(`[tabIndex='${$}']`))||t.focus()},[$]);const[G,J]=r(()=>{const e=_.filter(e=>!e.disabled);return[e.every(e=>-1!==d.findIndex(t=>t.value===e.value)),0!==e.length]},[_,d]);return n(()=>{(async()=>m?await m(c,M):function(e,t,r){if(!t)return e;const n=g(t,r);return e.filter(({label:e,value:t})=>null!=e&&null!=t).map(e=>({option:e,score:f(g(e.label,r),n)})).filter(e=>e.score>=n.length-2).sort((e,t)=>t.score-e.score).map(e=>e.option)}(c,M))().then(D)},[M,c]),e.createElement("div",{className:"select-panel",role:"listbox",ref:I},!C&&e.createElement("div",{className:"search"},e.createElement("input",{placeholder:l("search"),type:"text","aria-describedby":l("search"),onChange:e=>{j(e.target.value),T(e.target.value),H(x.SEARCH)},onFocus:()=>{H(x.SEARCH)},value:W,ref:P,tabIndex:0}),e.createElement("button",{type:"button",className:"search-clear-button",hidden:!W,onClick:z,"aria-label":l("clearSearch")},S||e.createElement(v,null))),e.createElement("ul",{className:"options"},N&&J&&e.createElement(y,{tabIndex:1===F?0:1,checked:G,option:U,onSelectionChanged:e=>{const t=(e=>{const t=_.filter(e=>!e.disabled).map(e=>e.value);if(e){const e=[...d.map(e=>e.value),...t];return _.filter(t=>e.includes(t.value))}return d.filter(e=>!t.includes(e.value))})(e);s(t)},onClick:()=>B(1),itemRenderer:E,disabled:w}),_.length?e.createElement(k,{skipIndex:F,options:_,onClick:(e,t)=>B(t)}):R?e.createElement("li",{onClick:async()=>{let e={label:W,value:W,__isNew__:!0};O&&(e=await O(W)),i([e,...c]),z(),s([...d,e])},className:"select-item creatable"},`${l("create")} "${W}"`):e.createElement("li",{className:"no-options"},l("noOptions"))))},C=({expanded:t})=>e.createElement("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"dropdown-heading-dropdown-arrow gray"},e.createElement("path",{d:t?"M18 15 12 9 6 15":"M6 9L12 15 18 9"})),N=()=>{const{t,value:r,options:n,valueRenderer:a}=u(),o=0===r.length,l=r.length===n.length,s=a&&a(r,n);return o?e.createElement("span",{className:"gray"},s||t("selectSomeItems")):e.createElement("span",null,s||(l?t("allItemsAreSelected"):r.map(e=>e.label).join(", ")))},S=({size:t=24})=>e.createElement("span",{style:{width:t,marginRight:"0.2rem"}},e.createElement("svg",{width:t,height:t,className:"spinner",viewBox:"0 0 50 50",style:{display:"inline",verticalAlign:"middle"}},e.createElement("circle",{cx:"25",cy:"25",r:"20",fill:"none",className:"path"}))),A=()=>{const{t:r,onMenuToggle:o,ArrowRenderer:l,shouldToggleOnHover:s,isLoading:c,disabled:i,onChange:d,labelledBy:m,value:p,isOpen:f,defaultIsOpen:g,ClearSelectedIcon:E,panelClassName:y,actionButtons:k=e.createElement(e.Fragment,null," ")}=u(),[x,A]=t(!0),[R,O]=t(g),[I,P]=t(!1),W=l||C,T=a();!function(e,t){const r=a(!1);n(()=>{r.current?o&&o(R):r.current=!0},t)}(0,[R]),n(()=>{void 0===g&&"boolean"==typeof f&&(A(!1),O(f))},[f]),h([b.ENTER,b.ARROW_DOWN,b.SPACE,b.ESCAPE],e=>{var t;["text","button"].includes(e.target.type)&&[b.SPACE,b.ENTER].includes(e.code)||(x&&(e.code===b.ESCAPE?(O(!1),null==T||null==(t=T.current)||t.focus()):O(!0)),e.preventDefault())},{target:T});const _=e=>{x&&s&&O(e)};return e.createElement("div",{tabIndex:0,className:"dropdown-container","aria-labelledby":m,"aria-expanded":R,"aria-readonly":!0,"aria-disabled":i,ref:T,onFocus:()=>!I&&P(!0),onBlur:e=>{!e.currentTarget.contains(e.relatedTarget)&&x&&(P(!1),O(!1))},onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1)},e.createElement("div",{className:"dropdown-heading",onClick:()=>{x&&O(!c&&!i&&!R)}},e.createElement("div",{className:"dropdown-heading-value"},e.createElement(N,null)),c&&e.createElement(S,null),p.length>0&&e.createElement("button",{type:"button",className:"clear-selected-button",onClick:e=>{e.stopPropagation(),d([]),x&&O(!1)},disabled:i,"aria-label":r("clearSelected")},E||e.createElement(v,null)),e.createElement(W,{expanded:R})),R&&e.createElement("div",{className:"dropdown-content"},e.createElement("div",{className:`panel-content ${y}`},e.createElement(w,null),k)))},R=t=>e.createElement(m,{props:t},e.createElement("div",{className:`rmsc ${t.className||"multi-select"}`},e.createElement(A,null)));export{A as Dropdown,R as MultiSelect,y as SelectItem,w as SelectPanel};
